image: registry.git.lacl.fr/barbot/cosmos:latest

before_script:
  - eval `opam config env`
  - export PATH=/usr/local/Cellar/flex/2.5.39/bin:/usr/local/Cellar/bison/3.0.4/bin:$PATH

stages:
  - build
  - test

cmake-build:
  stage: build
  script:
    - mkdir -p build-cmake
    - cd build-cmake
    - cmake ../
    - make -j 4
  allow_failure: true

Cosmos:
  stage: build
  script:
    - rm -rf build
    - autoreconf --install
    - mkdir build
    - cd build
    - ../configure --prefix=`pwd`/../ --enable-silent-rules
    - make -j 4
    - make install    
  artifacts:
    paths:
      - bin/
      - lib/
      - include/
  cache:
    paths:
      - bin/
      - lib/
      - include/

modelConvert:
  stage: build
  script:
    - mkdir -p bin
    - cd prism2SPT
    - ./build.sh
  artifacts:
    paths:
      - bin/
  cache:
    paths:
      - bin/
    
test:
  stage: test
  script:
    - echo `pwd`
    - cd Examples
    - ocaml bench.ml